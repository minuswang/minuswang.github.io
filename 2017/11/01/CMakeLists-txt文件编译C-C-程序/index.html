<!DOCTYPE html>
<html lang="">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="CMakeLists.txt文件编译C/C++程序"/>








  <link rel="alternate" href="/default" title="Minus Wang">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1" />



<link rel="canonical" href="http://minus.wang/2017/11/01/CMakeLists-txt文件编译C-C-程序/"/>


<meta name="description" content="&amp;gt;CMake编译原理CMake是一种跨平台编译工具，比make更为高级，使用起来要方便得多。CMake主要是编写CMakeLists.txt文件，然后用cmake命令将CMakeLists.txt文件转化为make所需要的makefile文件，最后用make命令编译源码生成可执行程序或共享库（so(shared object)）。因此CMake的编译基本就两个步骤：  cmake make">
<meta property="og:type" content="article">
<meta property="og:title" content="CMakeLists.txt文件编译C&#x2F;C++程序">
<meta property="og:url" content="http://minus.wang/2017/11/01/CMakeLists-txt文件编译C-C-程序/index.html">
<meta property="og:site_name" content="Minus Wang">
<meta property="og:description" content="&amp;gt;CMake编译原理CMake是一种跨平台编译工具，比make更为高级，使用起来要方便得多。CMake主要是编写CMakeLists.txt文件，然后用cmake命令将CMakeLists.txt文件转化为make所需要的makefile文件，最后用make命令编译源码生成可执行程序或共享库（so(shared object)）。因此CMake的编译基本就两个步骤：  cmake make">
<meta property="og:updated_time" content="2017-11-01T08:43:54.521Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CMakeLists.txt文件编译C&#x2F;C++程序">
<meta name="twitter:description" content="&amp;gt;CMake编译原理CMake是一种跨平台编译工具，比make更为高级，使用起来要方便得多。CMake主要是编写CMakeLists.txt文件，然后用cmake命令将CMakeLists.txt文件转化为make所需要的makefile文件，最后用make命令编译源码生成可执行程序或共享库（so(shared object)）。因此CMake的编译基本就两个步骤：  cmake make">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  



    <title> CMakeLists.txt文件编译C/C++程序 - Minus Wang </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">Minus Wang</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                Me
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/daohang">
                            
                            
                                Site
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/notes">
                            
                            
                                Note
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          CMakeLists.txt文件编译C/C++程序
        
      </h1>

      <time class="post-time">
          Nov 1 2017
      </time>
    </header>



    
            <div class="post-content">
            <h2 id="gt-CMake编译原理"><a href="#gt-CMake编译原理" class="headerlink" title="&gt;CMake编译原理"></a>&gt;CMake编译原理</h2><p><code>CMake</code>是一种跨平台编译工具，比<code>make</code>更为高级，使用起来要方便得多。<code>CMake</code>主要是编写<code>CMakeLists.txt</code>文件，然后用<code>cmake</code>命令将<code>CMakeLists.txt</code>文件转化为<code>make</code>所需要的<code>makefile</code>文件，最后用<code>make</code>命令编译源码生成可执行程序或共享库<code>（so(shared object)）</code>。因此<code>CMake</code>的编译基本就两个步骤：</p>
<ol>
<li>cmake</li>
<li>make</li>
</ol>
<p><code>cmake</code> 指向<code>CMakeLists.txt</code>所在的目录，例如<code>cmake ..</code>表示<code>CMakeLists.txt</code>在当前目录的上一级目录。<code>cmake</code>后会生成很多编译的中间文件以及<code>makefile</code>文件，所以一般建议新建一个新的目录，专门用来编译，例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkdir build</div><div class="line">cd build</div><div class="line">cmake ..</div><div class="line">make</div></pre></td></tr></table></figure>
<p><code>make</code>根据生成<code>makefile</code>文件，编译程序。</p>
<h2 id="gt-使用Cmake编译程序"><a href="#gt-使用Cmake编译程序" class="headerlink" title="&gt;使用Cmake编译程序"></a>&gt;使用<code>Cmake</code>编译程序</h2><p>我们编写一个关于开平方的<code>C/C++</code>程序项目，即<code>b= sqrt(a)</code>，以此理解整个<code>CMake</code>编译的过程。</p>
<p>a.准备程序文件</p>
<p>文件目录结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── build</div><div class="line">├── CMakeLists.txt</div><div class="line">├── include</div><div class="line">│   └── b.h</div><div class="line">└── src</div><div class="line">    ├── b.c</div><div class="line">    └── main.c</div></pre></td></tr></table></figure>
<p>头文件<code>b.h</code>，如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> B_FILE_HEADER_INC</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> B_FIEL_HEADER_INC</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">cal_sqrt</span><span class="params">(<span class="keyword">double</span> value)</span></span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<p>头文件<code>b.c</code>，如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"../include/b.h"</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">cal_sqrt</span><span class="params">(<span class="keyword">double</span> value)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">sqrt</span>(value);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>main.c</code>主函数，如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"../include/b.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">double</span> a = <span class="number">49.0</span>; </div><div class="line">    <span class="keyword">double</span> b = <span class="number">0.0</span>;</div><div class="line"></div><div class="line">    <span class="built_in">printf</span>(<span class="string">"input a:%f\n"</span>,a);</div><div class="line">    b = cal_sqrt(a);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"sqrt result:%f\n"</span>,b);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="gt-编写CMakeLists-txt"><a href="#gt-编写CMakeLists-txt" class="headerlink" title="&gt;编写CMakeLists.txt"></a>&gt;编写<code>CMakeLists.txt</code></h2><p>接下来编写<code>CMakeLists.txt</code>文件，该文件放在和<code>src</code>，<code>include</code>的同级目录，实际方哪里都可以，只要里面编写的路径能够正确指向就好了。<code>CMakeLists.txt</code>文件，如下所示：</p>
<blockquote>
<ol>
<li><code>cmake verson</code>，指定<code>cmake</code>版本 </li>
</ol>
</blockquote>
<p>  <code>cmake_minimum_required(VERSION 3.2)</code></p>
<blockquote>
<ol>
<li><code>project name</code>，指定项目的名称，一般和项目的文件夹名称对应</li>
</ol>
</blockquote>
<p>  <code>PROJECT(test_sqrt)</code></p>
<blockquote>
<ol>
<li><code>head file path</code>，头文件目录</li>
</ol>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> INCLUDE_DIRECTORIES(</div><div class="line"> include</div><div class="line">)</div></pre></td></tr></table></figure>
<blockquote>
<ol>
<li><code>source directory</code>，源文件目录</li>
</ol>
</blockquote>
<p> <code>AUX_SOURCE_DIRECTORY(src DIR_SRCS)</code></p>
<blockquote>
<ol>
<li><p><code>set environment variable</code>，设置环境变量，编译用到的源文件全部都要放到这里，否则编译能够通过，但是执行的时候会出现各种问题，比如<code>&quot;symbol lookup error xxxxx , undefined symbol&quot;</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SET(TEST_MATH</div><div class="line">$&#123;DIR_SRCS&#125;</div><div class="line">)</div></pre></td></tr></table></figure>
</li>
<li><p><code>add executable file</code>，添加要编译的可执行文件</p>
</li>
</ol>
</blockquote>
<p> <code>ADD_EXECUTABLE(${PROJECT_NAME} ${TEST_MATH})</code></p>
<blockquote>
<ol>
<li><code>add link library</code>，添加可执行文件所需要的库，比如我们用到了<code>libm.so</code>（命名规则：<code>lib+name+.so</code>），就添加该库的名称</li>
</ol>
</blockquote>
<p> <code>TARGET_LINK_LIBRARIES(${PROJECT_NAME} m)</code></p>
<p> <code>CMakeLists.txt</code>主要包含以上的7个步骤，具体的意义，请阅读相应的注释。</p>
<h2 id="gt-编译和运行程序"><a href="#gt-编译和运行程序" class="headerlink" title="&gt;编译和运行程序"></a>&gt;编译和运行程序</h2><p>准备好了以上的所有材料，接下来，就可以编译了，由于编译中出现许多中间的文件，因此最好新建一个独立的目录<code>build</code>，在该目录下进行编译，编译步骤如下所示：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkdir build</div><div class="line">cd build</div><div class="line">cmake ..</div><div class="line">make</div></pre></td></tr></table></figure></p>
<p>操作后，在<code>build</code>下生成的目录结构如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">├── build</div><div class="line">│   ├── CMakeCache.txt</div><div class="line">│   ├── CMakeFiles</div><div class="line">│   │   ├── <span class="number">3.2</span><span class="number">.2</span></div><div class="line">│   │   │   ├── CMakeCCompiler.cmake</div><div class="line">│   │   │   ├── CMakeCXXCompiler.cmake</div><div class="line">│   │   │   ├── CMakeDetermineCompilerABI_C.bin</div><div class="line">│   │   │   ├── CMakeDetermineCompilerABI_CXX.bin</div><div class="line">│   │   │   ├── CMakeSystem.cmake</div><div class="line">│   │   │   ├── CompilerIdC</div><div class="line">│   │   │   │   ├── a.out</div><div class="line">│   │   │   │   └── CMakeCCompilerId.c</div><div class="line">│   │   │   └── CompilerIdCXX</div><div class="line">│   │   │       ├── a.out</div><div class="line">│   │   │       └── CMakeCXXCompilerId.cpp</div><div class="line">│   │   ├── cmake.check_cache</div><div class="line">│   │   ├── CMakeDirectoryInformation.cmake</div><div class="line">│   │   ├── CMakeOutput.<span class="built_in">log</span></div><div class="line">│   │   ├── CMakeTmp</div><div class="line">│   │   ├── feature_tests.bin</div><div class="line">│   │   ├── feature_tests.c</div><div class="line">│   │   ├── feature_tests.cxx</div><div class="line">│   │   ├── Makefile2</div><div class="line">│   │   ├── Makefile.cmake</div><div class="line">│   │   ├── progress.marks</div><div class="line">│   │   ├── TargetDirectories.txt</div><div class="line">│   │   └── test_sqrt.dir</div><div class="line">│   │       ├── build.make</div><div class="line">│   │       ├── C.includecache</div><div class="line">│   │       ├── cmake_clean.cmake</div><div class="line">│   │       ├── DependInfo.cmake</div><div class="line">│   │       ├── depend.internal</div><div class="line">│   │       ├── depend.make</div><div class="line">│   │       ├── flags.make</div><div class="line">│   │       ├── link.txt</div><div class="line">│   │       ├── progress.make</div><div class="line">│   │       └── src</div><div class="line">│   │           ├── b.c.o</div><div class="line">│   │           └── main.c.o</div><div class="line">│   ├── cmake_install.cmake</div><div class="line">│   ├── Makefile</div><div class="line">│   └── test_sqrt</div><div class="line">├── CMakeLists.txt</div><div class="line">├── include</div><div class="line">│   └── b.h</div><div class="line">└── src</div><div class="line">    ├── b.c</div><div class="line">    └── main.c</div></pre></td></tr></table></figure>
<p>注意在<code>build</code>的目录下生成了一个可执行的文件<code>test_sqrt</code>,运行获取结果如下：</p>
<p>命令：<br><code>./test_sqrt</code><br>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">input a:49.000000</div><div class="line">sqrt result:7.000000</div></pre></td></tr></table></figure></p>
<p>d.源码</p>
<p><a href="http://files.cnblogs.com/files/cv-pr/test_sqrt.tar.gz" target="_blank" rel="external">地址：test_sqrt.tar.gz</a></p>
<p>3.参考资料</p>
<p><a href="http://blog.csdn.net/u012150179/article/details/17852273" target="_blank" rel="external">CMake 使用方法 &amp; CMakeList.txt</a></p>

            </div>
          

    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2015 -
    
    2017
    <span class="footer-author">MinusWang. All Rights Reserved. 砥砺前行-功不唐捐.</span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
